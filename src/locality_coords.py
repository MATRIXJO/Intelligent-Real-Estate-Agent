import difflib

LOCALITY_COORDS = {
    "whitefield": (12.9698, 77.7499),
    "whitefield hope farm": (12.9845, 77.7492),
    "kr puram": (13.0085, 77.6718),
    "k r puram": (13.0085, 77.6718),
    "hebbal": (13.0358, 77.5970),
    "yelahanka": (13.1024, 77.5963),
    "yelahanka new town": (13.1019, 77.5968),
    "yelahanka old town": (13.0952, 77.5804),
    "marathahalli": (12.9569, 77.7011),
    "hsr layout": (12.9122, 77.6387),
    "btm layout": (12.9166, 77.6101),
    "jayanagar": (12.9250, 77.5938),
    "jp nagar": (12.8992, 77.5850),
    "banashankari": (12.9426, 77.5468),
    "banashankari stage 2": (12.9319, 77.5573),
    "banashankari stage 3": (12.9147, 77.5681),
    "banashankari stage 6": (12.8994, 77.5512),
    "basavanagudi": (12.9418, 77.5669),
    "koramangala": (12.9344, 77.6100),
    "indiranagar": (12.9784, 77.6408),
    "mg road": (12.9757, 77.6069),
    "richmond town": (12.9676, 77.6033),
    "frazer town": (12.9983, 77.6220),
    "cox town": (12.9987, 77.6334),
    "ulsoor": (12.9837, 77.6287),
    "halasuru": (12.9837, 77.6287),
    "bellandur": (12.9280, 77.6762),
    "kadubeesanahalli": (12.9340, 77.6971),
    "sarjapur road": (12.9081, 77.6835),
    "sarjapur": (12.8618, 77.7924),
    "domlur": (12.9664, 77.6412),
    "kaggadasapura": (12.9830, 77.6770),
    "mahadevapura": (12.9960, 77.6953),
    "brookefield": (12.9699, 77.7172),
    "kundalahalli": (12.9564, 77.7178),
    "hoodi": (12.9967, 77.7116),
    "channasandra": (12.9952, 77.7378),
    "ramamurthy nagar": (13.0116, 77.6762),
    "kasturi nagar": (13.0074, 77.6622),
    "horamavu": (13.0311, 77.6654),
    "horamavu agara": (13.0375, 77.6488),
    "kalyan nagar": (13.0194, 77.6479),
    "hrbr layout": (13.0190, 77.6524),
    "hbr layout": (13.0285, 77.6355),
    "hennur": (13.0355, 77.6440),
    "nagawara": (13.0391, 77.6227),
    "manyata tech park": (13.0460, 77.6224),
    "thanisandra": (13.0601, 77.6301),
    "rk hegde nagar": (13.0702, 77.6342),
    "jakkur": (13.0859, 77.5980),
    "sahakara nagar": (13.0592, 77.5805),
    "vidyaranyapura": (13.0679, 77.5648),
    "tindlu": (13.0704, 77.5488),
    "dollars colony": (13.0298, 77.5685),
    "rmv 2nd stage": (13.0333, 77.5703),
    "mathikere": (13.0337, 77.5591),
    "gokula": (13.0280, 77.5560),
    "yeshwanthpur": (13.0186, 77.5560),
    "bel road": (13.0369, 77.5684),
    "rajajinagar": (12.9922, 77.5524),
    "basaveshwaranagar": (12.9910, 77.5360),
    "vijayanagar": (12.9675, 77.5331),
    "nagarbhavi": (12.9702, 77.4873),
    "kengeri": (12.9181, 77.4807),
    "rr nagar": (12.9270, 77.5150),
    "rajarajeshwari nagar": (12.9270, 77.5150),
    "mysore road": (12.9581, 77.4986),
    "magadi road": (12.9784, 77.5485),
    "attibele": (12.7759, 77.8004),
    "anekal": (12.7112, 77.6993),
    "jigani": (12.7836, 77.6847),
    "electronics city phase 1": (12.8406, 77.6778),
    "electronics city phase 2": (12.8391, 77.6932),
    "bommasandra": (12.7997, 77.7029),
    "bommanahalli": (12.8926, 77.6245),
    "tc palya": (13.0225, 77.7064),
    "aecs layout": (12.9622, 77.7083),
    "beml layout": (12.96218, 77.70376),
    "imadihalli": (12.9725, 77.7611),
    "patandur agrahara": (12.9750, 77.7502),
    "seegehalli": (13.0048, 77.7603),
    "bidarahalli": (13.0164, 77.7712),
    "hoskote": (13.0707, 77.7982),
    "anagalapura": (13.0850, 77.7025),
    "hennur bagalur road": (13.0818, 77.6535),
    "kogilu": (13.1123, 77.5945),
    "yelahanka airforce base": (13.1350, 77.5980),
    "bagalur road": (13.1202, 77.6515),
    "sompura": (12.8556, 77.7505),
    "varthur": (12.9402, 77.7475),
    "gunjur": (12.9270, 77.7473),
    "panathur": (12.9498, 77.7048),
    "balagere": (12.9492, 77.7310),
    "munnekollal": (12.9559, 77.7211),
    "thubarahalli": (12.9577, 77.7234),
    "kundalahalli colony": (12.9586, 77.7194),
    "doddanekundi": (12.9710, 77.6970),
    "borewell road": (12.9680, 77.7360),
    "raghuvanahalli": (12.8793, 77.5362),
    "thurahalli": (12.8834, 77.5390),
    "talaghattapura": (12.8653, 77.5429),
    "kanakapura road": (12.8611, 77.5730),
    "holiday village road": (12.8888, 77.5205),
    "kumarswamy layout": (12.9073, 77.5601),
    "padmanabhanagar": (12.9179, 77.5622),
    "uttarahalli": (12.9234, 77.5368),
    "subramanyapura": (12.9057, 77.5485),
    "hulimavu": (12.8904, 77.6059),
    "arekere": (12.8912, 77.6030),
    "koppa road": (12.8450, 77.5785),
    "bannerghatta": (12.8005, 77.5772),
    "gottigere": (12.8581, 77.5990),
    "begur road": (12.8850, 77.6265),
    "singasandra": (12.8914, 77.6371),
    "garvebhavi palya": (12.9050, 77.6421),
    "bommanahalli": (12.8926, 77.6245),
    "hosur road": (12.8879, 77.6323),
    "madiwala": (12.9175, 77.6170),
    "silk board": (12.9173, 77.6220),
    "agaram": (13.0080, 77.6427),
    "gowdanapalya": (12.9041, 77.5477),
    "shivajinagar": (12.9836, 77.6057),
    "seshadripuram": (12.9911, 77.5852),
    "raj bhavan": (12.9789, 77.5901),
    "richmond circle": (12.9668, 77.5995),
    "langford town": (12.9622, 77.6024),
    "wilson garden": (12.9509, 77.5980),
    "lakkasandra": (12.9449, 77.5985),
    "suddagunte palya": (12.9294, 77.6069),
    "btabhavan": (12.9125, 77.6120),
    "audugodi": (12.9400, 77.6125),
    "kodihalli": (12.9734, 77.6502),
    "murugeshpalya": (12.9586, 77.6595),
    "domlur layout": (12.9630, 77.6400),
    "kdomlur": (12.9635, 77.6408),
    "hal": (12.9656, 77.6580),
    "old airport road": (12.9591, 77.6658),
    "airport road": (12.9591, 77.6658),
    "wind tunnel road": (12.9611, 77.6633),
    "jeevan bima nagar": (12.9692, 77.6523),
    "beml 3rd stage": (12.9691, 77.6921),
    "tc palya main road": (13.0150, 77.6980),
    "ayar rajapura": (12.9980, 77.6800),
    "krishna raja pura": (13.0085, 77.6718),
    "nagondanahalli": (12.9640, 77.7500),
    "vartur kodi": (12.9425, 77.7462),
    "chikku tirupati road": (12.9300, 77.7800),
    "hosahalli": (13.0428, 77.5571),
    "ganganagar": (13.0215, 77.5892),
    "shampura": (13.0160, 77.6221),
    "kadugondanahalli": (13.0190, 77.6300),
    "kammanahalli": (13.0154, 77.6470),
    "lingarajapuram": (13.0151, 77.6280),
    "hudi": (12.9920, 77.7030),
    "banaswadi": (13.0123, 77.6513),
    "bapuji nagar": (12.9561, 77.5251),
     "radhakrishna nagar": (12.9588, 77.5132),
    "magadi road": (12.9691, 77.5190),
    "hosahalli metro": (12.9699, 77.5283),
    "vijayanagar": (12.9710, 77.5360),
    "hampinagar": (12.9716, 77.5302),
    "nagarbhavi": (12.9683, 77.5037),
    "ngef layout": (12.9650, 77.5021),
    "chandra layout": (12.9651, 77.5327),
    "attiguppe": (12.9580, 77.5239),
    "deepanjali nagar": (12.9542, 77.5080),
    "bapuji layout": (12.9491, 77.5203),
    "nayandahalli": (12.9426, 77.5063),
    "mysore road": (12.9521, 77.5151),
    "kengeri": (12.9141, 77.4951),
    "kengeri satellite town": (12.8994, 77.4827),
    "rajaji nagar": (12.9906, 77.5560),
    "basaveshwaranagar": (12.9898, 77.5425),
    "mahalakshmi layout": (13.0033, 77.5451),
    "kurubarahalli": (13.0000, 77.5360),
    "mallasandra": (12.9940, 77.5030),
    "hmt layout": (13.0281, 77.5548),
    "jalahalli": (13.0422, 77.5440),
    "jalahalli east": (13.0405, 77.5561),
    "jalahalli west": (13.0424, 77.5401),
    "hebbal kempapura": (13.0452, 77.5970),
    "amruthahalli": (13.0605, 77.5942),
    "judicial layout": (13.0720, 77.5685),
    "tindlu": (13.0675, 77.5582),
    "vidyaranyapura": (13.0672, 77.5560),
    "dollars colony": (13.0368, 77.5669),
    "rmv layout": (13.0320, 77.5695),
    "sanjay nagar": (13.0292, 77.5660),
    "ganga nagar": (13.0282, 77.5892),
    "arkinagar": (13.0200, 77.6005),
    "rt nagar": (13.0221, 77.6001),
    "kavalbyrasandra": (13.0194, 77.6060),
    "dinnur": (13.0190, 77.6071),
    "jawahar nagar": (13.0141, 77.6200),
    "cox town": (12.9987, 77.6271),
    "frazer town": (12.9990, 77.6256),
    "hbr layout": (13.0284, 77.6425),
    "hrbr layout": (13.0169, 77.6520),
    "kammanahalli main road": (13.0157, 77.6475),
    "lisa nagar": (13.0177, 77.6478),
    "babusa palya": (13.0221, 77.6561),
    "kalyan nagar": (13.0155, 77.6529),
    "horamavu": (13.0350, 77.6572),
    "ramamurthy nagar": (13.0115, 77.6767),
    "akruthi township": (13.0112, 77.6771),
    "babusabpalya": (13.0205, 77.6591),
    "benniganahalli": (12.9942, 77.6698),
    "krishnarajapuram": (13.0022, 77.6705),
    "tin factory": (12.9981, 77.6632),
    "kasturi nagar": (13.0082, 77.6628),
    "banasawadi": (13.0120, 77.6510),
    "cooke town": (12.9984, 77.6243),
    "richards town": (12.9981, 77.6220),
    "halasuru": (12.9711, 77.6171),
    "ulsoor": (12.9724, 77.6192),
    "mg road": (12.9753, 77.6068),
    "brigade road": (12.9718, 77.6070),
    "residency road": (12.9710, 77.6045),
    "st marks road": (12.9712, 77.5999),
    "church street": (12.9743, 77.6057),
    "lavelle road": (12.9684, 77.5991),
    "st johns road": (12.9790, 77.6165),
    "shivaji nagar": (12.9831, 77.6055),
    "vittal mallya road": (12.9702, 77.5967),
    "ashok nagar": (12.9716, 77.6060),
    "shantinagar": (12.9665, 77.6011),
    "double road": (12.9579, 77.6031),
    "lalbagh": (12.9511, 77.5847),
    "basavanagudi": (12.9434, 77.5733),
    "gandhi bazaar": (12.9431, 77.5722),
    "vv puram": (12.9510, 77.5736),
    "national college": (12.9440, 77.5702),
    "nagarathpet": (12.9678, 77.5842),
    "chickpet": (12.9675, 77.5765),
    "kr market": (12.9656, 77.5741),
    "majestic": (12.9776, 77.5726),
    "okalipuram": (12.9791, 77.5690),
    "subhash nagar": (12.9731, 77.5680),
    "sampangiram nagar": (12.9690, 77.5945),
    "richmond town": (12.9660, 77.6010),
    "kormangala 1st block": (12.9375, 77.6220),
    "koramangala 2nd block": (12.9372, 77.6241),
    "koramangala 3rd block": (12.9369, 77.6281),
    "koramangala 4th block": (12.9341, 77.6302),
     "koramangala 5th block": (12.9335, 77.6289),
    "koramangala 6th block": (12.9303, 77.6331),
    "koramangala 7th block": (12.9268, 77.6340),
    "koramangala 8th block": (12.9240, 77.6339),
    "somasundarapalya": (12.9082, 77.6504),
    "harlur": (12.9088, 77.6510),
    "sarjapur road": (12.9104, 77.6519),
    "kasavanahalli": (12.9052, 77.6710),
    "bellandur": (12.9279, 77.6777),
    "kadubeesanahalli": (12.9343, 77.6972),
    "marathahalli": (12.9568, 77.7011),
    "kundalahalli": (12.9650, 77.7017),
    "thubarahalli": (12.9644, 77.7121),
    "brookefield": (12.9671, 77.7168),
    "graphite india": (12.9773, 77.7170),
    "itpl": (12.9858, 77.7370),
    "whitefield": (12.9698, 77.7500),
    "hope farm": (12.9918, 77.7576),
    "channasandra": (12.9960, 77.7648),
    "kadugodi": (13.0082, 77.7605),
    "seegehalli": (13.0078, 77.7467),
    "bidarahalli": (13.0255, 77.7581),
    "hoskote": (13.0663, 77.7870),
    "medahalli": (13.0100, 77.7152),
    "kr puram": (12.9965, 77.6952),
    "hebbal ring road": (13.0401, 77.6302),
    "nagawara": (13.0288, 77.6282),
    "manyata tech park": (13.0568, 77.6248),
    "sahakara nagar": (13.0543, 77.5821),
    "kodigehalli": (13.0622, 77.5758),
    "yelahanka new town": (13.1041, 77.5808),
    "jakkur": (13.0745, 77.6001),
    "allalasandra": (13.0899, 77.5788),
    "puttenahalli yelahanka": (13.1111, 77.5944),
    "judicial layout yelahanka": (13.1071, 77.5711),
    "vidyaranyapura main road": (13.0678, 77.5578),
    "hebbal": (13.0358, 77.5970),
    "thanisandra": (13.0673, 77.6222),
    "rir layout": (13.0702, 77.6183),
    "srirampura": (12.9881, 77.5739),
    "mysore bank": (12.9726, 77.5807),
    "kalyan nagar hrbr": (13.0174, 77.6523),
    "horamavu agara": (13.0340, 77.6641),
    "hennur gardens": (13.0301, 77.6482),
    "gubbi cross": (13.0658, 77.6560),
    "kothanur": (13.0599, 77.6631),
    "doddagubbi": (13.0771, 77.6680),
    "kannur": (13.0902, 77.6622),
    "bagalur cross": (13.1283, 77.6577),
    "madanayakanahalli": (13.0400, 77.3700),
    "bilekahalli": (12.9002, 77.6091),
    "arekere": (12.8878, 77.6032),
    "bannerghatta road": (12.8829, 77.6010),
    "hulimavu": (12.8871, 77.6119),
    "begur road": (12.8921, 77.6361),
    "bommanahalli": (12.8953, 77.6415),
    "singasandra": (12.8805, 77.6510),
    "hosa road": (12.8665, 77.6739),
    "parappana agrahara": (12.8662, 77.6640),
    "electronic city phase 1": (12.8395, 77.6775),
    "electronic city phase 2": (12.8235, 77.6840),
    "anerpalya": (12.8281, 77.6913),
    "jigani": (12.7830, 77.6430),
    "bommasandra": (12.8144, 77.6941),
    "chandapura": (12.7950, 77.7062),
    "attibele": (12.7843, 77.7691),
    "sarjapur": (12.8604, 77.7812),
    "dommasandra": (12.8834, 77.7504),
    "kodathi": (12.9101, 77.7428),
    "carmelaram": (12.9250, 77.7320),
    "mudugere": (12.8971, 77.7601),
    "bidadi": (12.8244, 77.3844),
    "kumbalgodu": (12.9201, 77.4480),
    "rajankunte": (13.1693, 77.5561),
    "doddaballapur road": (13.1232, 77.5821),
    "avalahalli": (13.1120, 77.6280),
    "yelahanka": (13.0956, 77.5965),
    "peenya": (13.0281, 77.5199),
    "peenya industrial area": (13.0320, 77.5110),
    "nelamangala": (13.1007, 77.3905),
    "hessarghatta": (13.1391, 77.4781),
    "soladevanahalli": (13.1200, 77.4740),
    "kanakapura road": (12.8750, 77.5680),
    "thurahalli": (12.8881, 77.5262),
    "uttarahalli": (12.9130, 77.5462),
    "padmanabhanagar": (12.9192, 77.5603),
    "chikkalasandra": (12.9135, 77.5502),
    "banashankari": (12.9259, 77.5464),
    "banashankari stage 2": (12.9320, 77.5560),
    "banashankari stage 3": (12.9185, 77.5421),
    "banashankari stage 1": (12.9450, 77.5600),
    "jp nagar 1st phase": (12.9140, 77.5851),
    "jp nagar 2nd phase": (12.9080, 77.5855),
    "jp nagar 3rd phase": (12.9022, 77.5822),
    "jp nagar 4th phase": (12.9015, 77.5882),
    "jp nagar 5th phase": (12.8975, 77.5850),
    "jp nagar 6th phase": (12.8891, 77.5799),
    "jp nagar 7th phase": (12.8835, 77.5760),
    "jp nagar 8th phase": (12.8725, 77.5662),

}


ALL_LOCALITIES = list(LOCALITY_COORDS.keys())


def get_coords_for_locality(name: str):
    """
    1. Case-normalize
    2. Try exact match
    3. Try best fuzzy match
    """
    if not name:
        return None, None, None, 0.0

    s = name.lower().strip()

    # 1. Exact match
    if s in LOCALITY_COORDS:
        lat, lon = LOCALITY_COORDS[s]
        return lat, lon, s, 1.0

    # 2. Fuzzy match
    best = difflib.get_close_matches(s, ALL_LOCALITIES, n=1, cutoff=0.6)
    if best:
        key = best[0]
        lat, lon = LOCALITY_COORDS[key]
        return lat, lon, key, 0.8

    return None, None, None, 0.0

